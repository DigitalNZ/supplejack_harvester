<%= content_for(:title) { 'Pipelines' } %>

<%= content_for :header do %>
  <%= render 'shared/breadcrumb_nav' %>

  <h1 class="header__title">Pipelines</h1>

  <div class="clearfix"></div>
<% end %>

  <div class="float-end">
    <ul class='list-inline'>

      <li class='list-inline-item'>
        <strong>
          Sort by:
        </strong>
      </li>
      
    <li class='list-inline-item'>
      <%= form_with url: '/pipelines', method: :get do |form| %>
        <%= select_tag(:sort_by, options_for_select([['Alphabetical', 'name'], ['Last Edited', 'updated_at']], @sort_by.first), class: ' form-select', id: 'js-content-source-filter') %>
      <% end %>
    </li>

    </ul>
  </div>

  <div class='clearfix'></div>

  <div class='mb-4'></div>

  <div class='row'>

    <div class='col-3'>
      <button type="button" class="card mb-3 card--create-cta" data-bs-toggle="modal" data-bs-target="#create-modal">
        <div class="card-body">
          <h5 class="card-title">+ Create new pipeline</h5>
        </div>
      </button>
    </div>

    <%- @pipelines.each do |pipeline| %>
      <div class='col-3'>
        <%= link_to pipeline, class: 'card mb-3' do %>
          <div class="card-body">
            <h5 class="card-title"><%= pipeline.name %></h5>
          </div>
        <% end %>
      </div>
    <%- end %>

  </div>

<%= render 'shared/pagination_below_table', items: @pipelines %>

<div class="modal fade" id="create-modal" tabindex="-1" aria-labelledby="create-modal-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="create-modal-label">Create new pipeline</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

        <%= vertical_form_with model: @pipeline do |form| %>

          <div class='row gy-3 align-items-center'>
            <div class="col-4">
              <%= form.label :name, 'Pipeline Name', class: "form-label" %>
            </div>
            <div class='col-8'>
              <%= form.text_field :name, class: {"form-control": true, "is-invalid": @pipeline.errors[:name].any? } %>
            </div>
            
            <div class="col-4">
              <%= form.label :description, 'Pipeline Description', class: "form-label" %>
            </div>
            <div class='col-8'>
              <%= form.text_area :description, class: {"form-control": true, "is-invalid": @pipeline.errors[:description].any? } %>
            </div>
          </div>
          
          <div class='d-grid mt-4'>
            <button type="submit" class="btn btn-primary">Create pipeline</button>
          </div>
        <% end %>

      </div>
    </div>
  </div>
</div>


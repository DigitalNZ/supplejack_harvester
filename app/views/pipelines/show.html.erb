<%= content_for(:title) { @pipeline.name_in_database } %>

<%= content_for(:header) do %>
  <%= render 'shared/breadcrumb_nav' %>

  <div class='float-start'>
    <h1><%= @pipeline.name %></h1>
    <p><%= @pipeline.description %></p>
  </div>
  
  <div class="float-end">
    <button type="button" class="btn btn-primary me-1" data-bs-toggle="modal" data-bs-target="#run-from-extraction-job">
      Run from extraction job
    </button>
    <%= link_to "Edit", edit_pipeline_path(@pipeline), class: 'me-1 btn btn-outline-primary' %>
    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete-modal">Delete</button>
  </div>

  <div class='clearfix'></div>
  
  <div class='mt-4'></div>
  <ul class="nav nav-tabs">

    <li class='nav-item'>
      <%= link_to 'Pipeline', pipeline_path(@pipeline), class: "nav-link active" %>
    </li>
  </ul>
<% end %>

<input id="js-auto-complete-extraction-definition" class='js-auto-complete' data-src="<%= @extraction_definitions.to_json %>" data-placeholder='Start typing to use an existing definition..' data-key='name'>

<h4 class='mb-3'>Harvest</h4>
<p>Add an extraction and a transformation</p>

<div class='row definition-group'>
  <div class='col-6'>
    <button type="button" class="card card--create-cta d-flex" data-bs-toggle="modal" data-bs-target="#create-modal">
      <div class="card-body align-items-center d-flex justify-content-center">
        <p class='card-text'>+ Add harvest extraction</p>
      </div>
    </button>
  </div>

  <div class='col-6'>
    <button type="button" class="card mb-3 card--create-cta d-flex" data-bs-toggle="modal" data-bs-target="#create-modal">
      <div class="card-body align-items-center d-flex justify-content-center">
        <p class="card-text">+ Add harvest transformation</p>
      </div>
    </button>
  </div>
</div>

<div class='mt-4'></div>

<h4 class='mb-3'>Enrichment 1</h4>
<p>Add an extraction and a transformation</p>

<div class='row definition-group'>
  <span class='definition-group__bridge'></span>
  <div class='col-6'>
    <button type="button" class="card card--create-cta card--right-arrow d-flex" data-bs-toggle="modal" data-bs-target="#create-modal">
      <div class="card-body d-flex align-items-center justify-content-center">
        <p class='card-text'>+ Add enrichment extraction</p>
      </div>
    </button>
  </div>

  <div class='col-6'>
    <button type="button" class="card mb-3 card--create-cta d-flex" data-bs-toggle="modal" data-bs-target="#create-modal">
      <div class="card-body d-flex align-items-center justify-content-center d-flex">
        <p class="card-text">+ Add enrichment transformation</p>
      </div>
    </button>
  </div>
</div>

<%# Modals %>

<%= render layout: 'shared/delete-modal', locals: { path: pipeline_path(@pipeline) } do %>
  Are you sure you want to delete "<%= @pipeline.name %>"?
<% end %>

<%= render layout: 'shared/create-modal', locals: { modal_heading: 'Add harvest extraction', button_text: 'Add new extraction definition'  } do %>
  <div class='d-grid mt-4'>
    <div id="js-autocomplete-app"></div>
  </div>
<% end %>


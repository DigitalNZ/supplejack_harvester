<%= content_for(:title) { @content_source.name_in_database } %>

<%= content_for :header do %>
  <%= render 'shared/breadcrumb_nav' %>

  <h1 class="float-start"><%= @content_source.name_in_database %></h1>

  <%= link_to 'Edit content source', edit_content_source_path(@content_source), class: 'btn btn-outline-primary float-end' %>

  <div class="clearfix"></div>

  <div class='mt-4'></div>
  
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="harvests-tab" data-bs-toggle="tab" data-bs-target="#harvests" type="button" role="tab" aria-controls="harvests" aria-selected="true">Harvests</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="enrichments-tab" data-bs-toggle="tab" data-bs-target="#enrichments" type="button" role="tab" aria-controls="enrichments" aria-selected="false">Enrichments</button>
    </li>
  </ul>
<% end %>

<div class="tab-content">
  <div class="tab-pane fade show active" id="harvests" role="tabpanel" aria-labelledby="harvests-tab">

    <h4 class='mb-3'>Extractions</h4>

    <div class='row'>
      <%- if @harvest_extraction_definitions.any? %>
        <%- @harvest_extraction_definitions.each do |extraction_definition| %>
          <div class='col-3'>
            <%= link_to content_source_extraction_definition_path(@content_source, extraction_definition), class: 'card mb-3' do %>
              <div class='card-body'>
              
                <h5 class='card-title'><%= extraction_definition.name %></h5>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(extraction_definition.extraction_jobs.queued.count, 'job') %> queued
                </span>
                
                <span class="badge rounded-pill bg-success">
                  <%= pluralize(extraction_definition.extraction_jobs.running.count, 'job') %> running
                </span>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(extraction_definition.extraction_jobs.completed.count, 'job') %> completed
                </span>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(extraction_definition.extraction_jobs.cancelled.count, 'job') %> cancelled
                </span>
                
                <span class="badge rounded-pill bg-danger">
                  <%= pluralize(extraction_definition.extraction_jobs.errored.count, 'job') %> errored
                </span>

              </div>
            
            <% end %>
          </div>
        <%- end %>
      <% end %>
    
      <div class='col-3 align-self-center mb-3'>
        <div class="d-grid gap-2">
          <%= link_to new_content_source_extraction_definition_path(@content_source, kind: 'harvest'), class: 'btn btn-outline-primary' do %>
            <%= bootstrap_icon('plus') %>Create extraction
          <% end %>
        </div>
      </div>
    </div>

    <h4 class='mb-3'>Transformations</h4>
    
    <div class='row'>
      <%- if @harvest_transformation_definitions.any? %>
        <%- @harvest_transformation_definitions.each do |transformation_definition| %>
          <div class='col-3'>
            <%= link_to content_source_transformation_definition_path(@content_source, transformation_definition), class: 'card mb-3' do %>
              <div class='card-body'>
              
                <h5 class='card-title'><%= transformation_definition.name %></h5>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(transformation_definition.fields.count, 'field') %>
                </span>

              </div>
            
            <% end %>
          </div>
        <%- end %>
      <% end %>
    
      <div class='col-3 align-self-center mb-3'>
        <div class="d-grid gap-2">
          <%= link_to new_content_source_transformation_definition_path(@content_source, kind: 'harvest'), class: 'btn btn-outline-primary' do %>
            <%= bootstrap_icon('plus') %>Create transformation
          <% end %>
        </div>
      </div>
    </div>
    
    <h4 class='mb-3'>Harvests</h4>

    <div class='row'>
      <%- if @harvest_definitions.any? %>
        <%- @harvest_definitions.each do |harvest_definition| %>
          <div class='col-3'>
            <%= link_to content_source_harvest_definition_path(@content_source, harvest_definition), class: 'card mb-3' do %>
              <div class='card-body'>
              
                <h5 class='card-title'><%= harvest_definition.name %></h5>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(harvest_definition.harvest_jobs.queued.count, 'job') %> queued
                </span>
                
                <span class="badge rounded-pill bg-success">
                  <%= pluralize(harvest_definition.harvest_jobs.running.count, 'job') %> running
                </span>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(harvest_definition.harvest_jobs.completed.count, 'job') %> triggered successfully
                </span>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(harvest_definition.harvest_jobs.cancelled.count, 'job') %> cancelled
                </span>
                
                <span class="badge rounded-pill bg-danger">
                  <%= pluralize(harvest_definition.harvest_jobs.errored.count, 'job') %> errored
                </span>
              </div>
            
            <% end %>
          </div>
        <%- end %>
      <% end %>
    
      <div class='col-3 align-self-center mb-3'>
        <div class="d-grid gap-2">
          <%= link_to new_content_source_harvest_definition_path(@content_source, kind: 'harvest'), class: 'btn btn-outline-primary' do %>
            <%= bootstrap_icon('plus') %>Create harvest
          <% end %>
        </div>
      </div>
    </div>
    
  </div>

  
  <div class="tab-pane fade" id="enrichments" role="tabpanel" aria-labelledby="enrichments-tab">
    
    <h4 class='mb-3'>Extractions</h4>

    <div class='row'>
      <%- if @enrichment_extraction_definitions.any? %>
        <%- @enrichment_extraction_definitions.each do |extraction_definition| %>
          <div class='col-3'>
            <%= link_to content_source_extraction_definition_path(@content_source, extraction_definition), class: 'card mb-3' do %>
              <div class='card-body'>
              
                <h5 class='card-title'><%= extraction_definition.name %></h5>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(extraction_definition.extraction_jobs.queued.count, 'job') %> queued
                </span>
                
                <span class="badge rounded-pill bg-success">
                  <%= pluralize(extraction_definition.extraction_jobs.running.count, 'job') %> running
                </span>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(extraction_definition.extraction_jobs.completed.count, 'job') %> completed
                </span>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(extraction_definition.extraction_jobs.cancelled.count, 'job') %> cancelled
                </span>
                
                <span class="badge rounded-pill bg-danger">
                  <%= pluralize(extraction_definition.extraction_jobs.errored.count, 'job') %> errored
                </span>

              </div>
            
            <% end %>
          </div>
        <%- end %>
      <% end %>
    
      <div class='col-3 align-self-center mb-3'>
        <div class="d-grid gap-2">
          <%= link_to new_content_source_extraction_definition_path(@content_source, kind: 'enrichment'), class: 'btn btn-outline-primary' do %>
            <%= bootstrap_icon('plus') %>Create extraction
          <% end %>
        </div>
      </div>
    </div>
    
    <h4 class='mb-3'>Transformations</h4>
    
    <div class='row'>
      <%- if @enrichment_transformation_definitions.any? %>
        <%- @enrichment_transformation_definitions.each do |transformation_definition| %>
          <div class='col-3'>
            <%= link_to content_source_transformation_definition_path(@content_source, transformation_definition), class: 'card mb-3' do %>
              <div class='card-body'>
              
                <h5 class='card-title'><%= transformation_definition.name %></h5>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(transformation_definition.fields.count, 'field') %>
                </span>

              </div>
            
            <% end %>
          </div>
        <%- end %>
      <% end %>
    
      <div class='col-3 align-self-center mb-3'>
        <div class="d-grid gap-2">
          <%= link_to new_content_source_transformation_definition_path(@content_source, kind: 'enrichment'), class: 'btn btn-outline-primary' do %>
            <%= bootstrap_icon('plus') %>Create transformation
          <% end %>
        </div>
      </div>
    </div>
    
    <h4 class='mb-3'>Enrichments</h4>

    <div class='row'>
      <%- if @enrichment_definitions.any? %>
        <%- @enrichment_definitions.each do |enrichment_definition| %>
          <div class='col-3'>
            <%= link_to content_source_harvest_definition_path(@content_source, enrichment_definition), class: 'card mb-3' do %>
              <div class='card-body'>
              
                <h5 class='card-title'><%= enrichment_definition.name %></h5>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(enrichment_definition.harvest_jobs.queued.count, 'job') %> queued
                </span>
                
                <span class="badge rounded-pill bg-success">
                  <%= pluralize(enrichment_definition.harvest_jobs.running.count, 'job') %> running
                </span>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(enrichment_definition.harvest_jobs.completed.count, 'job') %> triggered successfully
                </span>
                
                <span class="badge rounded-pill bg-light text-dark">
                  <%= pluralize(enrichment_definition.harvest_jobs.cancelled.count, 'job') %> cancelled
                </span>
                
                <span class="badge rounded-pill bg-danger">
                  <%= pluralize(enrichment_definition.harvest_jobs.errored.count, 'job') %> errored
                </span>
              </div>
            
            <% end %>
          </div>
        <%- end %>
      <% end %>
    
      <div class='col-3 align-self-center mb-3'>
        <div class="d-grid gap-2">
          <%= link_to new_content_source_harvest_definition_path(@content_source, kind: 'enrichment'), class: 'btn btn-outline-primary' do %>
            <%= bootstrap_icon('plus') %>Create enrichment
          <% end %>
        </div>
      </div>
    </div>
    
  </div>

</div>


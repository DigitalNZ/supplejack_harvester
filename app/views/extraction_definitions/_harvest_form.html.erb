<%= vertical_form_with model: [@pipeline, @harvest_definition, @extraction_definition], id: 'js-extraction-definition-form' do |form| %>
  <%= form.hidden_field :pipeline_id, value: @pipeline.id %>
  <%= hidden_field_tag :referrer_id, @referrer&.id  %>

  <div class="row gx-2">
    <fieldset class="col-6">
      <div class="card">
        <div class="card-body">
          <legend>Common settings</legend>

          <div class="row gy-3 align-items-center">
            <% if @extraction_definition.name.present? %>
              <div class="col-3">
                <%= form.label :name, 'Name', class: "form-label" %>
              </div>
              <div class="col-9">
                <%= form.text_field :name, class: "form-control" %>
              </div>
            <% end %>

            <div class="col-3">
              <%= form.label :format, class: "form-label" do %>
                Format
                <span
                  data-bs-toggle="tooltip"
                  data-bs-title="The format the API returns"
                ><i class="bi bi-question-circle" aria-label="helper text"></i>
              <% end %>
            </div>
            <div class="col-9">
              <% options = find_options_from_validations(ExtractionDefinition, :format) %>
              <%= form.select :format, options, {}, class: "form-select" %>
            </div>

            <div class="col-3">
              <%= form.label :base_url, 'Base URL', class: "form-label" %>
            </div>
            <div class="col-9">
              <%= form.text_field :base_url, class: "form-control" %>
            </div>

            <div class="col-3">
              <%= form.label :throttle, 'Throttle (in ms)', class: "form-label" %>
            </div>
            <div class="col-9">
              <%= form.number_field :throttle, class: "form-control" %>
            </div>
          </div>
        </div>
      </div>
    </fieldset>

    <fieldset class="col-6">
      <div class="card">
        <div class="card-body">
          <legend>Pagination settings</legend>

          <div class="row gy-3 align-items-center">
            <div class="col-4">
              <%= form.label :pagination_type, 'Type', class: "form-label" %>
            </div>
            <div class="col-8">
              <% options = find_options_from_validations(ExtractionDefinition, :pagination_type) %>
              <%= form.select :pagination_type, options, {}, class: "form-select", id: 'js-extraction-definition-pagination-type' %>
            </div>

          </div>
        </div>
      </div>
    </fieldset>
  </div>
<% end %>

<div id="test-result"></div>
